# Задание 1

1. **Проанализируйте схему и описание системы.** Идентифицируйте существующие и потенциальные проблемные места. Напишите их список.
2. **Разработайте инициативы, которые необходимы для устранения нежелательных ситуаций.** Запишите их в список.
3. **Расставьте инициативы в порядке приоритета.** Опишите ход своих рассуждений и ответьте на вопросы:
    - Какой вы видите целевую архитектуру через полгода?
    - Если бы у вас была возможность выполнить только три пункта из списка инициатив в ближайшие полгода, что бы вы выбрали и почему? Не обязательно добавлять в список только эпики. Вы можете включить в план как крупные изменения, так и локальные задачи.

## Диаграмма компонентов системы

Система состоит из трёх приложений:

- Онлайн-магазин — написан на Vue и Java Spring Boot.
- CRM — SPA-приложение, фронтэнд написан на Vue, бэкенд — на Java Spring Boot.
- MES — SPA-приложение, фронтенд написан на React, бэкенд — на C#.

![Существующая архитектура](architecture-as-is.png)

Окружений всего три: dev, release и prod.

Каждый из инстансов крутится как EC2, базы данных — это Managed services на Yandex Cloud. Каждое приложение имеет по одному инстансу. Базы данных имеют один инстанс, который работает на запись и на чтение.

> [!NOTE] Важно!
> В текущей схеме развертывания отсутствует резервирование компонентов, что говорит о низкой отказоустойчивости и отсутствии возможности быстрого восстановления после сбоев. Не применяется горизонтальное масштабирование.

CI/CD реализован так:

- Деплой в dev-окружение осуществляется автоматически после мёрджа пул-реквеста и прохождения юнит-тестов.
- В release-окружения версию деплоят вручную.
- В продакшн версию тоже деплоят вручную.

## Статусы заказа

В скобках указана система, в которой происходит изменение:

- `INITIATED` [онлайн-магазин] — пользователь завёл новый заказ или положил товары в пустую корзину.
- `FILE_UPLOADED` [онлайн-магазин] — пользователь загрузил файл с 3D-моделью или создал его с помощью конструктора.
- `SUBMITTED` [онлайн-магазин] — пользователь нажал на кнопку «Сделать заказ».
- `PRICE_CALCULATED` [MES] — система посчитала стоимость заказа.
- `MANUFACTURING_APPROVED` [CRM] — заказ подтверждён, его можно отдавать в производство.
- `MANUFACTURING_STARTED` [MES] — оператор взял заказ в работу.
- `MANUFACTURING_COMPLETED` [MES] — оператор выполнил заказ.
- `PACKAGING` [MES] — оператор начал упаковывать заказ.
- `SHIPPED` [MES] — заказ отправлен покупателю.
- `CLOSED` [CRM] — заказ завершён. Он закрывается после получения сообщения от транспортной компании или вручную.

> [!NOTE] Важно!
> Большая часть этапов жизненного цикла заказа обрабатывается на стороне MES-системы.

## Организационное обеспечение

В инженерной команде, кроме вас, работает ещё восемь человек:

- Фронтенд — два инженера Vue, один частично знает React.
- Бэкенд — два инженера Java, один разработчик на C#.
- QA — один инженер по ручному тестированию, хочет заняться автоматизацией и уже делал несколько прототипов.
- Тимлид — бывший разработчик на C#.
- Продакт-менеджер — общается с бизнесом, отвечает за поддержку приложения.
- Один DevOps-инженер.

На стороне бизнеса в «Александрите» работают:

- Продавцы — это пользователи CRM.
- Операторы — пользователи MES.
- Администраторы — к ним относятся продакт-менеджер, тимлид и менеджеры по продажам.

Учитывайте, что наём потенциально активный. Компания может набрать ещё людей, но нужно обосновать, кто и зачем нужен.

## 1. Актуальные проблемы

1. Не выполняются сроки исполнения заказов.
	- Клиенты жалуются менеджерам по продажам, что они не получили заказ и над их изделием работают уже несколько месяцев, хотя обещали закончить за три недели. Проблемы не на стороне производства: производственные мощности позволяют справиться с заказами и могут обеспечить двукратный рост.
	- Через месяц после открытия API компания потеряла уже несколько крупных контрактов из-за проблем с заказами. Представители компаний ежедневно сообщают, что не получили свои заказы.
2. Низкое быстродействие MES-системы.
	- Участились жалобы от операторов: когда они заходят на первую страницу MES, система долго прогружается. На первой странице отображается список заказов в работе по статусам — это дашборд с фильтром.
	- Расчет стоимости заказа может занимать до 30 минут.
3. Полное отсутствие, либо низкий уровень наблюдаемости (obesrvability) системы.
	- Логи, метрики и записи трассировки позволили бы идентифицировать причины срыва сроков исполнения заказов, а также узкие места, влияющие на отзывчивость и быстродействие системы.
	- Уведомления об отклонениях от нормального режима функционирования системы (alerting) позволили бы оперативно реагировать на возникающие проблемы, не дожидаясь негативной обратной связи со стороны пользователей. 
4. Недостаточное организационное обеспечение для поддержки и развития MES-системы.
	- MES — важная система компании. Большая часть этапов жизненного цикла заказа обрабатывается на стороне MES-системы.
	- Один бэкенд-разработчик C# — bus-фактор.
	- Один фронтенд-разработчик частично знает React — недостаток квалификации + bus-фактор.
5. Задержки релизов.
	- Команда выпускает софт двухнедельными спринтами. Есть тестовое окружение, на нём QA-инженер прогоняет E2E-сценарии вручную. Если он обнаруживает баги уровня high или highest, то версию не деплоят на продакшн до их починки. Это часто приводит к значительным задержкам релиза. Раньше задержки не превышали одного месяца, но в последнее время требуется всё больше и больше времени.
	- Недостаточное организационное обеспечение в области контроля качества. QA — один инженер по ручному тестированию, хочет заняться автоматизацией и уже делал несколько прототипов.
	- Отсутствие автоматизации тестирования.
6. В текущей схеме развертывания отсутствует резервирование компонентов, что говорит о низкой отказоустойчивости и отсутствии возможности быстрого восстановления после сбоев. Не применяется горизонтальное масштабирование.
	- Каждое приложение имеет по одному инстансу. 
	- Базы данных имеют один инстанс, который работает на запись и на чтение.
7. Недостаточное организационное обеспечение в области DevOps.
	- Один DevOps-инженер — bus-фактор.

## 2. Инициативы направленные на решение проблем

> [!NOTE] Важно!
> Инициативы отсортированы в порядке приоритета. Первые три пункта необходимо выполнить в первую очередь.

1. Нанять дополнительных специалистов для улучшения квалификации команды и исключения bus-фактора.
	- 1 фронтенд-разработчик React с квалификацией не ниже middle для поддержки и развития приложения MES.
	- 1 бэкенд-разработчик C# с квалификацией не ниже middle для поддержки и развития приложения MES.
	- 1 QA-инженер — senior по автоматизации тестирования.
	- 1 DevOps middle.
2. Улучшить наблюдаемость (observability) системы.
	- *Внедрить мониторинг за метриками функционирования системы*: определить подход к мониторингу и перечень метрик для отслеживания. Мониторинг позволит отслеживать и выявлять отклонения от штатного режима функционирования системы. Позволит оперативно реагировать на возникающие проблемы, не дожидаясь негативной обратной связи со стороны пользователей.
	- *Внедрить трейсинг процесса обработки заказа*. Трейсинг позволит идентифицировать причины срыва сроков исполнения заказов, а также обнаружить узкие места, влияющие на отзывчивость и быстродействие системы.
	- *Внедрить логирование событий*. Логи позволят упростить анализ проблем и снизить время ответа на обращения пользователей в техническую поддержку.
3. Используя мониторинг и трейсинг, выявить узкие места снижающие быстродействие системы, а также идентифицировать причины срыва сроков исполнения заказов. Провести работы по их устранению.
	- Применить кэширование.
	- Применить паттерн Backpressure.
	- Применить паттерн Circuit Breaker.
	- Добавить инстансы серверов баз данных. Настроить репликацию. Направлять читающие запросы на реплики.  
4. Внедрить автоматизированное тестирование с целью сокращения задержек релизов. Запускать автоматические тесты в рамках CI/CD.
5. Обеспечить возможность горизонтального масштабирования MES-системы. Выделить функцию расчета стоимости изделия в отдельный сервис.